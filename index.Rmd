---
title: "nycanalysis"
author: "Drazzel Feliu"
date: "4/19/2019"
output: html_document
---

```{r}
library(tidyverse)
library(sf)
library(viridis)
library(leaflet)
library(maps)
library(htmlwidgets)
library(tidycensus)
library(htmltools)
```

```{r}
codebook <- load_variables(2017,"acs5")
```

```{r}
nycdata <- get_acs(geography = "tract",
        variables = "B19013_001",
        state = "NY",
        county = c("New York","Kings","Queens","Bronx","Richmond"),
        geometry = T,
        year = 2017)

nyccolor <- colorNumeric(
  palette = "magma",
  domain = nycdata$estimate)
```

```{r}
housingdata <- read.csv("Housing_New_York_Units_by_Building.csv")
glimpse(housingdata)
```

```{r}
nycdatahighlights <- highlightOptions(
  weight = 4.5,
  color = "#ffffff",
  fillOpacity = .5,
  bringToFront = TRUE)

nycdatalabeloptions <- labelOptions(
  style = list("font-weight" = "normal", padding = "3px 8px"),
  textsize = "15px",
  direction = "auto")
```

```{r, results='hide'}
nycdatalabels <- sprintf(
  paste0(
  "<strong>Name: </strong>%s<br/>",
  "<strong>Median Income in 2017: </strong>%g"),
  nycdata$NAME,
  nycdata$estimate
  ) %>% 
  lapply(HTML)
```


```{r}
map <- leaflet() %>% setView(lng = -74.0060, lat = 40.7128, zoom = 11) %>% 
  addProviderTiles(providers$CartoDB.Positron) %>% 
  addPolygons(data=st_geometry(nycdata),
              fillColor = nyccolor(nycdata$estimate),
              color = "magma",
              weight= .3,
              smoothFactor = .2,
              fillOpacity = .55,
              label = nycdatalabels,
              labelOptions = nycdatalabeloptions,
              group = "Paratransit",
              highlightOptions = nycdatahighlights
              ) %>% 
  addCircleMarkers(housingdata$Longitude, 
             housingdata$Latitude, 
             popup = as.character(housingdata$All.Counted.Units),
             clusterOptions = markerClusterOptions())
```

```{r}
saveWidget(map,"index.html")
```

